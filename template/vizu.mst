<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Formulaire de demande d'annalyse</title>

  <link href="https://cdn.rawgit.com/novus/nvd3/v1.8.1/build/nv.d3.css" rel="stylesheet" type="text/css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js" charset="utf-8"></script>
  <script src="https://cdn.rawgit.com/novus/nvd3/v1.8.1/build/nv.d3.min.js"></script>

  <style>
    text {
      font: 12px sans-serif;
    }
    .testBlock {
      display: block;
      float: left;
      height: 300px;
      width: 300px;
    }
    html, body {
      margin: 0px;
      padding: 0px;
      height: 100%;
      width: 100%;
    }
  </style>
</head>
<body>

<div class="testBlock"><svg id="topLangagesChart"></svg></div>

<script>
  var data = {{{ stats }}};

  // Top langage chart
  (function() {
    let testdata = [];
    data.topLanguageOrga.forEach((langage) => {
      testdata.push({
        key: Object.keys(langage)[0],
        y: langage[Object.keys(langage)[0]]
      });
    });

    var width = 300;
    var height = 300;

    nv.addGraph(function() {
      var chart = nv.models.pie()
          .x(function(d) { return d.key; })
          .y(function(d) { return d.y; })
          .width(width)
          .height(height)
          .labelType(function(d, i, values) {
            return values.key + ':' + values.value;
          })
          ;

      d3.select("#topLangagesChart")
          .datum([testdata])
          .transition().duration(1200)
          .attr('width', width)
          .attr('height', height)
          .call(chart);

      // LISTEN TO CLICK EVENTS ON THE PIE CONTAINER
      // chart.dispatch.on('chartClick', function() {
      //   code...
      // });

      // LISTEN TO CLICK EVENTS ON THE SLICES OF THE PIE
      // chart.dispatch.on('elementClick', function() {
      //   code...
      // });

      // OTHER EVENTS DISPATCHED BY THE PIE INCLUDE: elementDblClick, elementMouseover, elementMouseout, elementMousemove, renderEnd
      // @see nv.models.pie
      return chart;
    });
  })();

</script>
</body>
</html>